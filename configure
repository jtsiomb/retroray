#!/bin/sh

opt=true
dbg=true
rend=gl

for arg in $@; do
	case $arg in
	--enable-opt)
		opt=true
		;;
	--disable-opt)
		opt=false
		;;
	--enable-dbg)
		dbg=true
		;;
	--disable-dbg)
		dbg=false
		;;
	--rend=sw)
		rend=sw
		;;
	--rend=gl)
		rend=gl
		;;
	--rend=help)
		echo "Available viewport/UI renderer options: gl, sw"
		echo "  gl: OpenGL renderer"
		echo "  sw: Software renderer"
		exit 0
		;;
	*)
		;;
	esac
done

echo 'configuring retroray ...'
echo

sys=`uname -s`

case $sys in
IRIX)
	flags_sys='-n32 -mips3'
	;;
IRIX64)
	flags_sys='-n32 -mips4'
	;;
*)
	;;
esac

echo 'build options:'
echo "  optimizations: $opt"
echo "  debug symbols: $dbg"
echo "  viewport/ui renderer: $rend"
echo "  extra flags: $flags_sys"
echo

echo 'generating config.mk ...'
echo "# generated by configure" >config.mk

echo "build_opt = $opt" >>config.mk
if $opt; then
	echo "opt = -O3" >>config.mk
fi
echo "build_dbg = $dbg" >>config.mk
if $dbg; then
	echo "dbg = -g3" >>config.mk
fi

if [ "$rend" = gl ]; then
	echo "build_gfx = gl" >>config.mk
elif [ "$rend" = sw ]; then
	echo "build_gfx = sw" >>config.mk
fi

if [ -n "$CFLAGS" -o -n "$flags_sys" ]; then
	echo "CFLAGS_extra = $flags_sys $CFLAGS" >>config.mk
fi
if [ -n "$LDFLAGS" -o -n "$flags_sys" ]; then
	echo "LDFLAGS_extra = $flags_sys $LDFLAGS" >>config.mk
fi
